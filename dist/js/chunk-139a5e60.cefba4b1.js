(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-139a5e60"],{"66da":function(e,t,a){"use strict";var n=a("0c6d");t["a"]={createOne:function(e){return n["a"].post("/categories",e)},updateOneWithId:function(e,t){return n["a"].patch("/categories/".concat(e),t)},deleteOneWithId:function(e){return n["a"].delete("/categories/".concat(e))},fetchList:function(){return n["a"].get("/categories")}}},e83f:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("panel",[a("div",{attrs:{slot:"header"},slot:"header"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加文章分类")])],1),a("el-table",{attrs:{data:e.dataList,border:""}},[a("el-table-column",{attrs:{label:"分类名称",prop:"name"}}),a("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("el-image",{staticStyle:{width:"80px",height:"80px"},attrs:{src:t.cover.path,fit:"cover","preview-src-list":[t.cover.path]}})]}}])}),a("el-table-column",{attrs:{label:"文章数量",prop:"articleCount"}}),a("el-table-column",{attrs:{label:"已发布文章数量",prop:"articlePublishedCount"}}),a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(e._s(new Date(a.createdAt).toLocaleString()))]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row,i=t.$index;return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.editOne(n)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.deleteOne(n.id,i)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{visible:e.dialogVisible,title:e.dialogTitle},on:{opened:e.onDialogOpen,close:e.closeDialog}},[a("el-form",{attrs:{"label-width":"auto"}},[a("el-form-item",{attrs:{label:"分类名称"}},[a("el-input",{ref:"input",attrs:{clearable:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"分类封面"}},[a("upload",{attrs:{"file-list":e.fileList},on:{remove:function(t){e.form.cover={name:"",path:""}},success:function(t){return Object.assign(e.form.cover,t)}}})],1)],1),a("el-button",{attrs:{slot:"footer"},on:{click:e.handleSubmit},slot:"footer"},[e._v("确定")])],1)],1)},i=[],r=(a("7f7f"),a("ac6a"),a("96cf"),a("3b8d")),o=a("66da"),s={data:function(){return{fileList:[],form:{name:"",cover:{path:"",name:""}},dialogVisible:!1,dataList:[],action:""}},created:function(){var e=this;o["a"].fetchList().then((function(t){e.dataList=t})).catch((function(t){e.$message.error(t.message)}))},computed:{dialogTitle:function(){return"create"===this.action?"添加文章分类":"编辑文章分类"}},methods:{onDialogOpen:function(){this.$refs.input.focus()},openDialog:function(){this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1,this.resetDialog()},resetDialog:function(){this.form.name="",this.form.cover={name:"",path:""},this.fileList=[]},handleAdd:function(){this.action="create",this.openDialog()},deleteOne:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,a){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("此文章分类以经删除将无法恢复，是否删除?","警告",{type:"warning"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e["catch"](0),e.abrupt("return");case 8:o["a"].deleteOneWithId(t).then((function(){n.dataList.splice(a,1),n.$message.success("删除成功")})).catch((function(e){n.$message.error(e.message)}));case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t,a){return e.apply(this,arguments)}return t}(),editOne:function(e){this.action="edit",this.editingItem=e,_.merge(this.form,_.pick(e,_.keys(this.form))),this.form.cover.path&&(this.fileList=[{url:this.form.cover.path,name:this.form.cover.name}]),this.openDialog()},handleSubmit:function(){var e=this,t=this.form,a=t.name,n=t.cover;if(a)if(n.path){var i={name:a,cover:n},r="create"===this.action?o["a"].createOne(i):o["a"].updateOneWithId(this.editingItem.id,i);r.then((function(t){"create"===e.action?e.dataList.unshift(t):_.assign(e.editingItem,i),e.$message.success("".concat(e.dialogTitle,"成功")),e.closeDialog()})).catch((function(t){e.closeDialog(),e.$message.error(t.message)}))}else this.$message.error("请上传文章分类封面");else this.$message.error("请输入文章分类名称")}}},c=s,l=a("2877"),u=Object(l["a"])(c,n,i,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-139a5e60.cefba4b1.js.map